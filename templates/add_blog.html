{% extends "layouts/base.html" %} {% block title %}Add Blog{% endblock title %}
{% block content %}
{% include "components/navbar.html" %}
<div
  x-data="{ title: '', content: '', showSuccess: false, showError: false }"
  class="container mt-5 pt-2"
>
  
  <h1 class="title has-text-centered is-underlined is-italic">
    WRITE YOUR STORY
  </h1>


  <div class="columns is-centered">
    <div class="column is-half">
      <form @submit.prevent="submitForm">
        <div class="field">
          <div class="control">
            <input
              x-model="title"
              class="mt-5 input is-rounded is-italic has-background-grey-lighter has-text-weight-bold"
              type="text"
              placeholder="Enter title"
              required
            />
          </div>
        </div>
        <div class="field">
          <label class="label is-size-5 is-italic mt-4">Your Story</label>
          <div class="control">
            <textarea
              x-model="content"
              class="textarea is-medium is-italic"
              placeholder="Write......."
              rows="20"
              required
            ></textarea>
          </div>
        </div>
        <div class="field is-grouped is-grouped-centered">
          <div class="control">
            <button type="submit" class="button is-primary is-medium">
              Publish
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div
    x-show="showSuccess"
    x-transition:enter="transition ease-out duration-300"
    x-transition:leave="transition ease-in duration-300"
    class="notification is-success is-light"
    x-cloak
  >
    Blog submitted successfully!
  </div>

  <div
    x-show="showError"
    x-transition:enter="transition ease-out duration-300"
    x-transition:leave="transition ease-in duration-300"
    class="notification is-danger is-light"
    x-cloak
  >
    Error submitting blog. Please try again later.
  </div>
</div>

<script>
  function submitForm() {
    const formData = {
      title: this.title,
      content: this.content,
    };

    console.log(formData.title);
    console.log(formData.content);

    fetch("/add_blog", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(formData),
    })
      .then((response) => {
        if (!response.ok) {
          throw new Error("Failed to submit blog");
        }
        this.showSuccess = true; 
        this.showError = false; 
        window.location.href = "/";
      })
      .catch((error) => {
        console.error("Error submitting blog:", error);
        this.showError = true; 
        this.showSuccess = false;
      });
  }
</script>
{% endblock content %}
